# =============================================================================
# tasker-ctl - cargo-make Task Definitions
# =============================================================================
#
# CLI binary for the Tasker orchestration system. Depends on tasker-sdk
# for codegen, template engine, and schema inspection capabilities.
#
# Quick Start:
#   cargo make check              # Run all quality checks
#   cargo make test               # Run tests
#   cargo make fix                # Auto-fix issues
#   cargo make validate-codegen   # Validate generated output syntax
#
# =============================================================================

extend = "../cargo-make/base-tasks.toml"

[config]
default_to_workspace = false

[env]
CRATE_NAME = "tasker-ctl"

# =============================================================================
# Main Tasks
# =============================================================================

[tasks.default]
alias = "check"

[tasks.check]
description = "Run quality checks"
dependencies = ["format-check", "lint", "test"]

[tasks.format-check]
extend = "base-rust-format"

[tasks.format-fix]
extend = "base-rust-format-fix"

[tasks.lint]
extend = "base-rust-lint"

[tasks.lint-fix]
extend = "base-rust-lint-fix"

[tasks.test]
extend = "base-rust-test"
description = "Run tasker-ctl tests"
args = ["nextest", "run", "-p", "${CRATE_NAME}", "--all-features"]

[tasks.fix]
description = "Fix all fixable issues"
dependencies = ["format-fix", "lint-fix"]

[tasks.clean]
description = "Clean build artifacts"
command = "cargo"
args = ["clean", "-p", "${CRATE_NAME}"]

# =============================================================================
# Codegen Validation
# =============================================================================

[tasks.validate-codegen]
description = "Build tasker-ctl and validate all generated codegen output for syntax"
category = "Validation"
script = '''
cargo build --package tasker-ctl
${SCRIPTS_DIR}/validate-codegen.sh --binary target/debug/tasker-ctl
'''
