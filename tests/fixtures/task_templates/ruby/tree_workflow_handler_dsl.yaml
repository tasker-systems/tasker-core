# TaskTemplate Configuration - DSL Variant - Ruby Implementation
#
# Tree Workflow Pattern with Ruby Step Handlers via FFI
# Demonstrates complex hierarchical tree structure with multiple branches and convergence
#
# Template: tree_workflow/hierarchical_tree:1.0.0
# Implementation: Ruby FFI with tasker-rb
# Updated: 2025-09-24 (Fixed Template Format)
#
# Tree Pattern (8 steps):
# 1. Root: Square input (6 → 36)
# 2. Branch Left: Square root result (36 → 1,296)
# 3. Branch Right: Square root result (36 → 1,296)
# 4. Leaf D: Square left branch (1,296 → 1,679,616)
# 5. Leaf E: Square left branch (1,296 → 1,679,616)
# 6. Leaf F: Square right branch (1,296 → 1,679,616)
# 7. Leaf G: Square right branch (1,296 → 1,679,616)
# 8. Final Convergence: Multiply all 4 leaves and square
# Final result: input^32
#
---
name: hierarchical_tree_dsl
namespace_name: tree_workflow_dsl
version: 1.0.0
description: "Complex hierarchical tree workflow: root → branches → leaves → convergence (input^32)"
metadata:
  author: Ruby FFI Implementation
  tags:
    - namespace:tree_workflow_dsl
    - pattern:hierarchical_tree
    - dependencies:complex_multi_parent
    - implementation:ruby_ffi
    - language:ruby
    - type_safety:runtime
    - parallelism:multi_branch
    - convergence:four_way
  documentation_url:
  created_at: "2025-09-24T00:00:00Z"
  updated_at: "2025-09-24T00:00:00Z"
  notes: "Ruby FFI implementation with complex hierarchical dependency resolution"
system_dependencies:
  primary: default
  secondary: []
domain_events: []
input_schema:
  type: object
  required:
    - even_number
  properties:
    even_number:
      type: integer
      minimum: 2
      maximum: 100
      description: "Even number for hierarchical tree calculation"
steps:
  - name: tree_root_dsl
    description: "Tree root: Square the input even number"
    handler:
      callable: tree_workflow_dsl.step_handlers.tree_root
      initialization:
        operation: square
        step_type: root
        description: "Root of the tree: square the input"
        branches:
          - tree_branch_left_dsl
          - tree_branch_right_dsl
    system_dependency:
    dependencies: []
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_branch_left_dsl
    description: "Left branch: Square the root result"
    handler:
      callable: tree_workflow_dsl.step_handlers.tree_branch_left
      initialization:
        operation: square
        step_type: branch
        branch_side: left
        description: "Left branch: square the root result"
        leaves:
          - tree_leaf_d_dsl
          - tree_leaf_e_dsl
    system_dependency:
    dependencies:
      - tree_root_dsl
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_branch_right_dsl
    description: "Right branch: Square the root result"
    handler:
      callable: tree_workflow_dsl.step_handlers.tree_branch_right
      initialization:
        operation: square
        step_type: branch
        branch_side: right
        description: "Right branch: square the root result"
        leaves:
          - tree_leaf_f_dsl
          - tree_leaf_g_dsl
    system_dependency:
    dependencies:
      - tree_root_dsl
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_leaf_d_dsl
    description: "Leaf D: Square the left branch result"
    handler:
      callable: tree_workflow_dsl.step_handlers.tree_leaf_d
      initialization:
        operation: square
        step_type: leaf
        leaf_id: d
        parent_branch: left
        description: "Leaf D: square left branch result"
    system_dependency:
    dependencies:
      - tree_branch_left_dsl
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_leaf_e_dsl
    description: "Leaf E: Square the left branch result"
    handler:
      callable: tree_workflow_dsl.step_handlers.tree_leaf_e
      initialization:
        operation: square
        step_type: leaf
        leaf_id: e
        parent_branch: left
        description: "Leaf E: square left branch result"
    system_dependency:
    dependencies:
      - tree_branch_left_dsl
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_leaf_f_dsl
    description: "Leaf F: Square the right branch result"
    handler:
      callable: tree_workflow_dsl.step_handlers.tree_leaf_f
      initialization:
        operation: square
        step_type: leaf
        leaf_id: f
        parent_branch: right
        description: "Leaf F: square right branch result"
    system_dependency:
    dependencies:
      - tree_branch_right_dsl
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_leaf_g_dsl
    description: "Leaf G: Square the right branch result"
    handler:
      callable: tree_workflow_dsl.step_handlers.tree_leaf_g
      initialization:
        operation: square
        step_type: leaf
        leaf_id: g
        parent_branch: right
        description: "Leaf G: square right branch result"
    system_dependency:
    dependencies:
      - tree_branch_right_dsl
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_final_convergence_dsl
    description: "Final convergence: Multiply all 4 leaf results and square"
    handler:
      callable: tree_workflow_dsl.step_handlers.tree_final_convergence
      initialization:
        operation: multiply_all_and_square
        step_type: final_convergence
        description: "Converge all 4 leaves: multiply all then square"
        convergence_pattern: "((leaf_d × leaf_e × leaf_f × leaf_g)²)"
        final_result: "input^32"
        leaf_count: 4
    system_dependency:
    dependencies:
      - tree_leaf_d_dsl
      - tree_leaf_e_dsl
      - tree_leaf_f_dsl
      - tree_leaf_g_dsl
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 45
    publishes_events: []
environments:
  test:
    steps:
      - name: tree_root_dsl
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: tree_branch_left_dsl
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: tree_branch_right_dsl
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: tree_leaf_d_dsl
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: tree_leaf_e_dsl
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: tree_leaf_f_dsl
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: tree_leaf_g_dsl
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: tree_final_convergence_dsl
        timeout_seconds: 20
        retry:
          max_attempts: 2