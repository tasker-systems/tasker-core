# TypeScript FFI: client_create_task JSON trailing input error via koffi

## Problem

All `client_create_task` FFI calls through the published `@tasker-systems/tasker` npm package (v0.1.3) fail with a JSON parsing error:

```
TaskerClientError: client_create_task failed: Invalid argument: Invalid task request JSON: trailing input at line 1 column 577
```

The column number varies per payload size but the "trailing input" error is consistent across all task creation calls.

## Root Cause (Suspected)

The koffi FFI bridge passes JavaScript strings to the Rust `client_create_task(request_json: *const c_char)` function. The Rust side uses `CStr::from_ptr()` to read the string, then `serde_json::from_str()` to parse it. The "trailing input" serde error means extra bytes exist after the valid JSON closing `}`.

This suggests the koffi `str` to `*const c_char` conversion is either:

* Not properly null-terminating the string
* Including extra buffer data after the string content
* A buffer size mismatch in the string encoding

## Impact

* All task creation via the TypeScript FFI client is broken
* The `TaskerClient.createTask()` method always fails
* Basic tests pass because routes catch the error and return null task_uuid
* Completion/integration tests fail because they require task creation to succeed

## Relationship

* Blocked by TAS-282 (bundled library path resolution)
* Both issues must be fixed before publishing a working @tasker-systems/tasker package
* Affects Bun example app completion tests in tasker-contrib

## Metadata
- URL: [https://linear.app/tasker-systems/issue/TAS-283/typescript-ffi-client-create-task-json-trailing-input-error-via-koffi](https://linear.app/tasker-systems/issue/TAS-283/typescript-ffi-client-create-task-json-trailing-input-error-via-koffi)
- Identifier: TAS-283
- Status: In Progress
- Priority: High
- Assignee: Pete Taylor
- Labels: Bug
- Project: [Road to Tasker Alpha](https://linear.app/tasker-systems/project/road-to-tasker-alpha-763400a12d53). Take Tasker from a codebase easy to develop on, to a project easy to use: published packages, cross-language SDKs, consumer docs, and bootstrap tooling.
- Project milestone: Phase 0: Foundation & Cleanup
- Created: 2026-02-15T17:52:51.366Z
- Updated: 2026-02-15T23:57:35.384Z
